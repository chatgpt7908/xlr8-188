FROM docker.io/library/wordpress:6.5.2-php8.2-apache

# ❌ Broken DB creds
ENV WORDPRESS_DB_HOST=wp-backend-broken \
    WORDPRESS_DB_NAME=wrongdb \
    WORDPRESS_DB_USER=wronguser \
    WORDPRESS_DB_PASSWORD=wrongpass

# Install MySQL client so wait-for-db.sh can use mysqladmin
RUN apt-get update \
 && apt-get install -y default-mysql-client netcat-traditional \
 && rm -rf /var/lib/apt/lists/*
COPY index.php /var/www/html/index.php
WORKDIR /
# Copy in our “wait for DB” script
COPY wait-db.sh /wait-db.sh
RUN chmod +x /wait-db.sh

EXPOSE 80

ENTRYPOINT ["/wait-db.sh"]
CMD ["apache2-foreground"]

